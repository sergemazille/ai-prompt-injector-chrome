const I18N_TRANSLATIONS = {
  en: {
    'btn.import': 'Import',
    'btn.export': 'Export',
    'btn.backups': 'Backups',
    'btn.newPrompt': 'New Prompt',
    'btn.cancel': 'Cancel',
    'btn.save': 'Save',
    'btn.insert': 'Insert',
    'btn.copy': 'Copy',
    'btn.edit': 'Edit',
    'btn.delete': 'Delete',
    'btn.restore': 'Restore',
    'search.placeholder': 'Search prompts...',
    'filter.allTags': 'All tags',
    'import.method1.title': 'Method 1: Drag and drop',
    'import.method1.desc': 'Drag your JSON file here',
    'import.method2.title': 'Method 2: Browse',
    'import.method2.selectFile': 'Select a file',
    'import.method3.title': 'Method 3: Paste JSON',
    'import.method3.placeholder': 'Paste your JSON here (Ctrl+V)',
    'import.method3.btn': 'Import',
    'import.method3.tip': 'Tip: You can paste directly with Ctrl+V in the text area',
    'import.acceptedFormats': 'Only .json files are accepted',
    'import.recommended': 'Recommended',
    'backup.info': 'Automatic backups on browser startup and before each import. Export regularly in case of uninstall.',
    'backup.empty': 'No backups yet.',
    'backup.reason.startup': 'Startup',
    'backup.reason.update': 'Extension update',
    'backup.reason.preImport': 'Before import',
    'backup.reason.preRestore': 'Before restore',
    'backup.reason.manual': 'Manual',
    'form.newPrompt': 'New Prompt',
    'form.editPrompt': 'Edit Prompt',
    'form.titleLabel': 'Title:',
    'form.contentLabel': 'Content:',
    'form.tagsLabel': 'Tags (comma-separated):',
    'form.tagsPlaceholder': 'tag1, tag2, tag3',
    'empty.message': 'No prompts found. Create your first prompt!',
    'filter.noResults': 'No prompts match the current filter.',
    'notify.pasteFirst': 'Please paste JSON content first',
    'notify.selectJson': 'Please select a JSON file',
    'notify.noNewImported': 'No new prompts imported',
    'notify.importedAll': '{0} prompts imported successfully!',
    'notify.importedPartial': '{0}/{1} prompts imported',
    'notify.importError': 'Import error: {0}',
    'notify.cannotInject': 'Cannot inject here. Prompt copied to clipboard.',
    'notify.restored': '{0} prompts restored',
    'notify.restoreError': 'Error restoring backup',
    'notify.copied': 'Prompt copied!',
    'notify.copyError': 'Error copying prompt',
    'notify.addedFavorite': 'Added to favorites (moved to top)',
    'notify.removedFavorite': 'Removed from favorites (repositioned by date)',
    'notify.favoriteError': 'Error updating favorite status',
    'notify.importElementError': 'Error: import-file element not found',
    'alert.titleContentRequired': 'Title and content are required',
    'alert.saveError': 'Error saving prompt. Please try again.',
    'alert.exportError': 'Error exporting prompts. Please try again.',
    'alert.noActiveTab': 'No active tab found',
    'alert.deleteError': 'Error deleting prompt. Please try again.',
    'confirm.delete': 'Are you sure you want to delete this prompt?',
    'confirm.restore': 'Restore this backup? Your current prompts will be saved as a backup first.',
    'aria.importPrompts': 'Import prompts',
    'aria.exportPrompts': 'Export prompts',
    'aria.manageBackups': 'Manage backups',
    'aria.createNewPrompt': 'Create new prompt',
    'aria.filterByTag': 'Filter prompts by tag',
    'aria.tagSuggestions': 'Tag suggestions',
    'aria.toggleTheme': 'Toggle theme',
    'aria.addFavorite': 'Add {0} to favorites',
    'aria.removeFavorite': 'Remove {0} from favorites',
    'aria.filterByTagValue': 'Filter by tag: {0}',
    'aria.insertPrompt': 'Insert prompt: {0}',
    'aria.copyPrompt': 'Copy prompt: {0}',
    'aria.editPrompt': 'Edit prompt: {0}',
    'aria.deletePrompt': 'Delete prompt: {0}',
  },
  fr: {
    'btn.import': 'Importer',
    'btn.export': 'Exporter',
    'btn.backups': 'Sauvegardes',
    'btn.newPrompt': 'Nouveau',
    'btn.cancel': 'Annuler',
    'btn.save': 'Enregistrer',
    'btn.insert': 'Insérer',
    'btn.copy': 'Copier',
    'btn.edit': 'Modifier',
    'btn.delete': 'Supprimer',
    'btn.restore': 'Restaurer',
    'search.placeholder': 'Rechercher des prompts...',
    'filter.allTags': 'Tous les tags',
    'import.method1.title': 'Méthode 1 : Glisser-déposer',
    'import.method1.desc': 'Glissez votre fichier JSON ici',
    'import.method2.title': 'Méthode 2 : Parcourir',
    'import.method2.selectFile': 'Choisir un fichier',
    'import.method3.title': 'Méthode 3 : Coller du JSON',
    'import.method3.placeholder': 'Collez votre JSON ici (Ctrl+V)',
    'import.method3.btn': 'Importer',
    'import.method3.tip': 'Astuce : vous pouvez coller directement avec Ctrl+V dans la zone de texte',
    'import.acceptedFormats': 'Seuls les fichiers .json sont acceptés',
    'import.recommended': 'Recommandé',
    'backup.info': 'Sauvegardes automatiques au démarrage du navigateur et avant chaque import. Exportez régulièrement en cas de désinstallation.',
    'backup.empty': 'Aucune sauvegarde pour le moment.',
    'backup.reason.startup': 'Démarrage',
    'backup.reason.update': 'Mise à jour',
    'backup.reason.preImport': 'Avant import',
    'backup.reason.preRestore': 'Avant restauration',
    'backup.reason.manual': 'Manuelle',
    'form.newPrompt': 'Nouveau prompt',
    'form.editPrompt': 'Modifier le prompt',
    'form.titleLabel': 'Titre :',
    'form.contentLabel': 'Contenu :',
    'form.tagsLabel': 'Tags (séparés par des virgules) :',
    'form.tagsPlaceholder': 'tag1, tag2, tag3',
    'empty.message': 'Aucun prompt trouvé. Créez votre premier prompt !',
    'filter.noResults': 'Aucun prompt ne correspond au filtre actuel.',
    'notify.pasteFirst': 'Veuillez d\'abord coller du contenu JSON',
    'notify.selectJson': 'Veuillez sélectionner un fichier JSON',
    'notify.noNewImported': 'Aucun nouveau prompt importé',
    'notify.importedAll': '{0} prompts importés avec succès !',
    'notify.importedPartial': '{0}/{1} prompts importés',
    'notify.importError': 'Erreur d\'import : {0}',
    'notify.cannotInject': 'Injection impossible ici. Prompt copié dans le presse-papiers.',
    'notify.restored': '{0} prompts restaurés',
    'notify.restoreError': 'Erreur lors de la restauration',
    'notify.copied': 'Prompt copié !',
    'notify.copyError': 'Erreur lors de la copie',
    'notify.addedFavorite': 'Ajouté aux favoris (déplacé en haut)',
    'notify.removedFavorite': 'Retiré des favoris (repositionné par date)',
    'notify.favoriteError': 'Erreur lors de la mise à jour du favori',
    'notify.importElementError': 'Erreur : élément import-file introuvable',
    'alert.titleContentRequired': 'Le titre et le contenu sont requis',
    'alert.saveError': 'Erreur lors de l\'enregistrement. Veuillez réessayer.',
    'alert.exportError': 'Erreur lors de l\'export. Veuillez réessayer.',
    'alert.noActiveTab': 'Aucun onglet actif trouvé',
    'alert.deleteError': 'Erreur lors de la suppression. Veuillez réessayer.',
    'confirm.delete': 'Êtes-vous sûr de vouloir supprimer ce prompt ?',
    'confirm.restore': 'Restaurer cette sauvegarde ? Vos prompts actuels seront d\'abord sauvegardés.',
    'aria.importPrompts': 'Importer des prompts',
    'aria.exportPrompts': 'Exporter des prompts',
    'aria.manageBackups': 'Gérer les sauvegardes',
    'aria.createNewPrompt': 'Créer un nouveau prompt',
    'aria.filterByTag': 'Filtrer les prompts par tag',
    'aria.tagSuggestions': 'Suggestions de tags',
    'aria.toggleTheme': 'Changer de thème',
    'aria.addFavorite': 'Ajouter {0} aux favoris',
    'aria.removeFavorite': 'Retirer {0} des favoris',
    'aria.filterByTagValue': 'Filtrer par tag : {0}',
    'aria.insertPrompt': 'Insérer le prompt : {0}',
    'aria.copyPrompt': 'Copier le prompt : {0}',
    'aria.editPrompt': 'Modifier le prompt : {0}',
    'aria.deletePrompt': 'Supprimer le prompt : {0}',
  }
};

const I18N_LOCALE = navigator.language.startsWith('fr') ? 'fr' : 'en';

function t(key, ...params) {
  let str = I18N_TRANSLATIONS[I18N_LOCALE]?.[key]
    ?? I18N_TRANSLATIONS.en[key]
    ?? key;
  params.forEach((val, i) => {
    str = str.replace(`{${i}}`, val);
  });
  return str;
}

function applyI18nToDOM() {
  document.querySelectorAll('[data-i18n]').forEach(el => {
    el.textContent = t(el.dataset.i18n);
  });
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    el.placeholder = t(el.dataset.i18nPlaceholder);
  });
  document.querySelectorAll('[data-i18n-aria-label]').forEach(el => {
    el.setAttribute('aria-label', t(el.dataset.i18nAriaLabel));
  });
}
